import{r as g,k as e,a0 as K,a1 as ge,V as W,T as O,N as G,a2 as he,a3 as le,a4 as z,_ as $,a5 as M,a6 as Z,a7 as Y,Y as ee,Z as je,W as se,a8 as Ne,a9 as te,aa as re,ab as ne,ac as q,ad as ie,ae as ye,af as ue,ag as be,ah as ce}from"./vendor-BzTNOEb7.js";import{C as r,a as l,b as n,c as y,d as i,B as v}from"./card-4yZC5ysd.js";import{B as h,U as pe}from"./USHeatMap-DBBBwgPg.js";import{L as de,g as xe,h as oe,i as fe}from"./vendor-ui-ZiQ-hUGH.js";import{c as T,u as ae}from"./index-BISoVz64.js";import{u as ve,L as J}from"./vendor-router-g4NWHk9I.js";import"./vendor-maps-Cr_Lmh8h.js";import"./vendor-charts-B_ZyQ9af.js";const we=fe,me=g.forwardRef(({className:t,...s},m)=>e.jsx(de,{ref:m,className:T("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...s}));me.displayName=de.displayName;const L=g.forwardRef(({className:t,...s},m)=>e.jsx(xe,{ref:m,className:T("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...s}));L.displayName=xe.displayName;const A=g.forwardRef(({className:t,...s},m)=>e.jsx(oe,{ref:m,className:T("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));A.displayName=oe.displayName;const S=g.forwardRef(({className:t,...s},m)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:m,className:T("w-full caption-bottom text-sm",t),...s})}));S.displayName="Table";const R=g.forwardRef(({className:t,...s},m)=>e.jsx("thead",{ref:m,className:T("[&_tr]:border-b",t),...s}));R.displayName="TableHeader";const U=g.forwardRef(({className:t,...s},m)=>e.jsx("tbody",{ref:m,className:T("[&_tr:last-child]:border-0",t),...s}));U.displayName="TableBody";const _e=g.forwardRef(({className:t,...s},m)=>e.jsx("tfoot",{ref:m,className:T("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...s}));_e.displayName="TableFooter";const N=g.forwardRef(({className:t,...s},m)=>e.jsx("tr",{ref:m,className:T("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...s}));N.displayName="TableRow";const o=g.forwardRef(({className:t,...s},m)=>e.jsx("th",{ref:m,className:T("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...s}));o.displayName="TableHead";const d=g.forwardRef(({className:t,...s},m)=>e.jsx("td",{ref:m,className:T("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...s}));d.displayName="TableCell";const ke=g.forwardRef(({className:t,...s},m)=>e.jsx("caption",{ref:m,className:T("mt-4 text-sm text-muted-foreground",t),...s}));ke.displayName="TableCaption";const Te=()=>{var I,j,Q,B,V;const[t,s]=g.useState(null),[m,D]=g.useState(!0),[b,w]=g.useState("all"),[x,f]=g.useState(null),{toast:p}=ae(),F=async c=>{try{D(!0);const _=new URLSearchParams({limit:"50",offset:"0"});c&&c!=="all"&&_.append("cache_mode",c);const k=await fetch(`/api/analytics/timeline?${_}`,{headers:{"X-Admin-Token":"flip_ruby"}});if(!k.ok)throw new Error("Failed to fetch timeline");const E=await k.json();s(E)}catch(_){console.error("Timeline fetch error:",_),p({title:"Error",description:"Failed to load timeline data",variant:"destructive"})}finally{D(!1)}};g.useEffect(()=>{F(b==="all"?void 0:b)},[b]);const P=c=>{switch(c){case"exact":case"exact_hit":return e.jsx(q,{className:"h-4 w-4 text-green-500"});case"semantic":case"semantic_hit":return e.jsx(q,{className:"h-4 w-4 text-blue-500"});case"database":return e.jsx(q,{className:"h-4 w-4 text-purple-500"});case"topic":return e.jsx(q,{className:"h-4 w-4 text-cyan-500"});case"miss":return e.jsx(ce,{className:"h-4 w-4 text-red-500"});default:return e.jsx(ne,{className:"h-4 w-4 text-gray-500"})}},X=c=>{switch(c){case"exact":case"exact_hit":return e.jsx(h,{className:"bg-green-900/50 text-green-400 border-green-700",children:"Exact Hit"});case"semantic":case"semantic_hit":return e.jsx(h,{className:"bg-blue-900/50 text-blue-400 border-blue-700",children:"Semantic Hit"});case"database":return e.jsx(h,{className:"bg-purple-900/50 text-purple-400 border-purple-700",children:"DB Hit"});case"topic":return e.jsx(h,{className:"bg-cyan-900/50 text-cyan-400 border-cyan-700",children:"Topic Hit"});case"miss":return e.jsx(h,{className:"bg-red-900/50 text-red-400 border-red-700",children:"Cache Miss"});default:return e.jsx(h,{className:"bg-gray-700 text-gray-400 border-gray-600",children:"Unknown"})}},H=c=>new Date(c).toLocaleString(),C=c=>(c==null?void 0:c.toLocaleString())||"0";return m?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(O,{className:"h-6 w-6 animate-spin mr-2"}),"Loading timeline..."]}):e.jsxs("div",{className:"space-y-6",children:[(t==null?void 0:t.stats)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(r,{className:"bg-slate-800/50 border-slate-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Total Questions"}),e.jsx(se,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:t.stats.total_questions}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 24 hours"})]})]}),e.jsxs(r,{className:"bg-slate-800/50 border-slate-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Cache Hit Rate"}),e.jsx(z,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:[((I=t.stats.cache_hit_rate)==null?void 0:I.toFixed(1))||0,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(t.stats.exact_hits||0)+(t.stats.semantic_hits||0)," hits"]})]})]}),e.jsxs(r,{className:"bg-slate-800/50 border-slate-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Avg Latency"}),e.jsx(ie,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:[Math.round(t.stats.avg_latency||0),"ms"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Response time"})]})]}),e.jsxs(r,{className:"bg-slate-800/50 border-slate-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Tokens Used"}),e.jsx(ye,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:C(t.stats.total_tokens_used)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total consumption"})]})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsx(n,{className:"text-gray-200",children:"Question Timeline"}),e.jsx(y,{className:"text-gray-400",children:"Comprehensive view of all questions, cache performance, and token usage"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(v,{size:"sm",onClick:()=>w("all"),className:b==="all"?"bg-orange-600 hover:bg-orange-700 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300 border border-gray-600",children:"All Questions"}),e.jsx(v,{size:"sm",onClick:()=>w("exact_hit"),className:b==="exact_hit"?"bg-orange-600 hover:bg-orange-700 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300 border border-gray-600",children:"Exact Hits"}),e.jsx(v,{size:"sm",onClick:()=>w("semantic_hit"),className:b==="semantic_hit"?"bg-orange-600 hover:bg-orange-700 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300 border border-gray-600",children:"Semantic Hits"}),e.jsx(v,{size:"sm",onClick:()=>w("miss"),className:b==="miss"?"bg-orange-600 hover:bg-orange-700 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300 border border-gray-600",children:"Cache Misses"})]}),e.jsx("div",{className:"rounded-md border border-gray-700",children:e.jsxs(S,{children:[e.jsx(R,{children:e.jsxs(N,{className:"border-gray-700",children:[e.jsx(o,{className:"text-gray-400",children:"Timestamp"}),e.jsx(o,{className:"text-gray-400",children:"Question"}),e.jsx(o,{className:"text-gray-400",children:"Cache Mode"}),e.jsx(o,{className:"text-gray-400",children:"Similarity"}),e.jsx(o,{className:"text-gray-400",children:"Latency"}),e.jsx(o,{className:"text-gray-400",children:"Tokens"}),e.jsx(o,{className:"text-gray-400",children:"Citations"}),e.jsx(o,{className:"text-gray-400",children:"Actions"})]})}),e.jsx(U,{children:(j=t==null?void 0:t.entries)==null?void 0:j.map(c=>{var _,k;return e.jsxs(N,{className:"border-gray-700",children:[e.jsx(d,{className:"text-sm text-gray-300",children:H(c.timestamp)}),e.jsxs(d,{className:"max-w-md",children:[e.jsx("div",{className:"truncate text-gray-300",title:c.question,children:c.question}),c.answer_preview&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 truncate",children:c.answer_preview})]}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[P(c.cache_mode),X(c.cache_mode)]})}),e.jsx(d,{children:c.semantic_similarity?e.jsxs(h,{className:"bg-gray-700 text-orange-500 border-gray-600",children:[(c.semantic_similarity*100).toFixed(1),"%"]}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsx(d,{children:e.jsxs(h,{className:"bg-gray-700 text-orange-500 border-gray-600 text-xs",children:[c.latency_ms,"ms"]})}),e.jsx(d,{children:e.jsx("div",{className:"text-sm",children:(_=c.token_usage)!=null&&_.total_tokens?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-orange-500",children:C(c.token_usage.total_tokens)}),((k=c.token_usage)==null?void 0:k.prompt_tokens)&&e.jsxs("div",{className:"text-xs text-gray-500",children:["P: ",C(c.token_usage.prompt_tokens)," / C: ",C(c.token_usage.completion_tokens||0)]})]}):e.jsx("span",{className:"text-gray-500",children:"-"})})}),e.jsx(d,{children:e.jsx(h,{className:"bg-gray-700 text-orange-500 border-gray-600",children:c.citations_count})}),e.jsx(d,{children:e.jsx(v,{size:"sm",onClick:()=>f(c),className:"bg-gray-700 hover:bg-gray-600 text-gray-300",children:e.jsx(ee,{className:"h-4 w-4"})})})]},c.id)})})]})}),(!(t!=null&&t.entries)||t.entries.length===0)&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No questions found for the selected filter."})]})]}),x&&e.jsxs(r,{className:"mt-4 bg-slate-700/50 border-slate-600",children:[e.jsx(l,{className:"relative",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-orange-500",children:"Question Details"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{const c={question:x.question,answer:x.full_answer||x.answer_preview,cache_mode:x.cache_mode,latency_ms:x.latency_ms,token_usage:x.token_usage,citations_count:x.citations_count,timestamp:x.timestamp,user_ip:x.user_ip},_=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),k=URL.createObjectURL(_),E=document.createElement("a");E.href=k,E.download=`question-${x.id}.json`,E.click(),URL.revokeObjectURL(k),p({title:"Downloaded",description:"Question data exported successfully"})},className:"border-orange-500/50 text-orange-500 hover:bg-orange-500/10",children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"Download"]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:async()=>{if(window.confirm("Are you sure you want to delete this question data?"))try{if((await fetch(`/api/analytics/timeline/${x.id}`,{method:"DELETE",headers:{"X-Admin-Token":new URLSearchParams(window.location.search).get("token")||""}})).ok)p({title:"Deleted",description:"Question data deleted successfully"}),f(null),F(b==="all"?void 0:b);else throw new Error("Delete failed")}catch(c){p({title:"Error",description:"Failed to delete question data",variant:"destructive"})}},className:"border-red-500/50 text-red-500 hover:bg-red-500/10",children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Delete"]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>f(null),className:"text-slate-400 hover:text-white",children:"âœ•"})]})]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[e.jsx("label",{className:"font-medium text-orange-500 block mb-2",children:"Question:"}),e.jsx("p",{className:"text-white",children:x.question})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[e.jsx("label",{className:"font-medium text-orange-500 block mb-2",children:"Full Answer:"}),e.jsx("p",{className:"text-slate-300 whitespace-pre-wrap max-h-96 overflow-y-auto",children:x.full_answer||x.answer_preview||"No answer available"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[e.jsx("label",{className:"font-medium text-orange-500 text-sm block mb-1",children:"Cache Mode"}),e.jsx("div",{className:"mt-1",children:X(x.cache_mode)})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[e.jsx("label",{className:"font-medium text-orange-500 text-sm block mb-1",children:"Latency"}),e.jsxs("p",{className:"text-white font-semibold",children:[x.latency_ms,"ms"]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[e.jsx("label",{className:"font-medium text-orange-500 text-sm block mb-1",children:"Citations"}),e.jsx("p",{className:"text-white font-semibold",children:x.citations_count})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[e.jsx("label",{className:"font-medium text-orange-500 text-sm block mb-1",children:"User IP"}),e.jsx("p",{className:"text-white font-mono text-sm",children:x.user_ip})]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[e.jsx("label",{className:"font-medium text-orange-500 block mb-2",children:"Token Usage:"}),(Q=x.token_usage)!=null&&Q.total_tokens?e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Total:"}),e.jsx("span",{className:"text-white ml-2 font-semibold",children:C(x.token_usage.total_tokens)})]}),((B=x.token_usage)==null?void 0:B.prompt_tokens)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Prompt:"}),e.jsx("span",{className:"text-white ml-2 font-semibold",children:C(x.token_usage.prompt_tokens)})]}),((V=x.token_usage)==null?void 0:V.completion_tokens)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Completion:"}),e.jsx("span",{className:"text-white ml-2 font-semibold",children:C(x.token_usage.completion_tokens)})]})]}):e.jsx("div",{className:"text-sm text-slate-400",children:x.cache_mode&&x.cache_mode!=="miss"?"No tokens used (cache hit)":"Token data not available"})]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Timestamp: ",H(x.timestamp)," | ID: ",x.id]})]})]})]})},Ce=({adminToken:t})=>{const[s,m]=g.useState(null),[D,b]=g.useState(!0),{toast:w}=ae(),x=async()=>{try{const p=await fetch("/cache/metrics",{headers:t?{"X-Admin-Token":t}:{}});if(p.ok){const F=await p.json();m(F)}}catch(p){console.error("Failed to fetch cache metrics:",p)}finally{b(!1)}},f=async()=>{if(!t){w({title:"Error",description:"Admin token required",variant:"destructive"});return}try{(await fetch("/cache/clear",{method:"POST",headers:{"X-Admin-Token":t}})).ok?(w({title:"Success",description:"Cache cleared successfully"}),x()):w({title:"Error",description:"Failed to clear cache",variant:"destructive"})}catch(p){w({title:"Error",description:"Failed to clear cache",variant:"destructive"})}};return g.useEffect(()=>{x();const p=setInterval(x,3e4);return()=>clearInterval(p)},[]),D?e.jsx(A,{value:"cache",className:"space-y-6",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(O,{className:"h-6 w-6 animate-spin mr-2"}),"Loading cache metrics..."]})}):e.jsxs(A,{value:"cache",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Cache Hit Rate"}),e.jsx(z,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:(s==null?void 0:s.hit_rate)||"0%"}),e.jsxs("p",{className:"text-xs text-gray-400",children:[(s==null?void 0:s.total_hits)||0," total hits"]})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Exact Hits"}),e.jsx(q,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:(s==null?void 0:s.exact_hits)||0}),e.jsxs("p",{className:"text-xs text-gray-400",children:[(s==null?void 0:s.exact_misses)||0," misses"]})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Semantic Hits"}),e.jsx(le,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:(s==null?void 0:s.semantic_hits)||0}),e.jsxs("p",{className:"text-xs text-gray-400",children:[(s==null?void 0:s.semantic_misses)||0," misses"]})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Database Hits"}),e.jsx(M,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:(s==null?void 0:s.db_hits)||0}),e.jsxs("p",{className:"text-xs text-gray-400",children:[(s==null?void 0:s.db_writes)||0," writes, ",(s==null?void 0:s.db_errors)||0," errors"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex items-center space-x-2 text-gray-200",children:[e.jsx(M,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{children:"Cache Storage"})]}),e.jsx(y,{className:"text-gray-400",children:"Memory and database cache utilization"})]}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Memory Cache (L1)"}),e.jsxs(h,{className:"bg-gray-700 text-orange-500 border-gray-600",children:[(s==null?void 0:s.memory_cache_size)||0," / ",(s==null?void 0:s.max_memory_entries)||1e3," entries"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-orange-500 h-2 rounded-full transition-all",style:{width:`${Math.min(((s==null?void 0:s.memory_cache_size)||0)/((s==null?void 0:s.max_memory_entries)||1e3)*100,100)}%`}})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Semantic Entries"}),e.jsxs(h,{className:"bg-gray-700 text-orange-500 border-gray-600",children:[(s==null?void 0:s.semantic_cache_size)||0," entries"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-orange-400 h-2 rounded-full transition-all",style:{width:`${Math.min(((s==null?void 0:s.semantic_cache_size)||0)/((s==null?void 0:s.max_memory_entries)||1e3)*100,100)}%`}})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Database Cache (L2)"}),e.jsx(h,{className:s!=null&&s.database_available?"bg-orange-600 text-white":"bg-gray-700 text-gray-400 border-gray-600",children:s!=null&&s.database_available?`${(s==null?void 0:s.database_cache_size)||0} entries`:"Unavailable"})]}),(s==null?void 0:s.database_available)&&e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-orange-600 h-2 rounded-full transition-all",style:{width:`${Math.min(((s==null?void 0:s.database_cache_size)||0)/((s==null?void 0:s.max_db_entries)||1e4)*100,100)}%`}})})]})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex items-center space-x-2 text-gray-200",children:[e.jsx(ie,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{children:"Cache Configuration"})]}),e.jsx(y,{className:"text-gray-400",children:"Current cache settings and actions"})]}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"TTL (Time to Live)"}),e.jsxs(h,{className:"bg-gray-700 text-orange-500 border-gray-600",children:[(s==null?void 0:s.ttl_hours)||24," hours"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Max Memory Entries"}),e.jsx(h,{className:"bg-gray-700 text-orange-500 border-gray-600",children:(s==null?void 0:s.max_memory_entries)||1e3})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Max Database Entries"}),e.jsx(h,{className:"bg-gray-700 text-orange-500 border-gray-600",children:(s==null?void 0:s.max_db_entries)||1e4})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Database Available"}),e.jsx(h,{className:s!=null&&s.database_available?"bg-orange-600 text-white":"bg-red-900 text-red-200",children:s!=null&&s.database_available?"Yes":"No"})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-700",children:[e.jsxs(v,{className:"w-full bg-red-900 hover:bg-red-800 text-red-200",onClick:f,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Clear All Caches"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"This will clear both memory and database caches"})]})]})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsx(n,{className:"text-gray-200",children:"Cache Performance Insights"}),e.jsx(y,{className:"text-gray-400",children:"Understanding your cache efficiency"})]}),e.jsx(i,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:(s==null?void 0:s.exact_hits)||0}),e.jsx("p",{className:"text-sm text-gray-300",children:"Exact Query Matches"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Fastest response time"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:(s==null?void 0:s.semantic_hits)||0}),e.jsx("p",{className:"text-sm text-gray-300",children:"Semantic Matches"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Similar question detection"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:(s==null?void 0:s.db_hits)||0}),e.jsx("p",{className:"text-sm text-gray-300",children:"Database Cache Hits"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Persisted responses"})]})]})})]})]})},Pe=()=>{var Q,B,V,c,_,k,E;const[t]=ve(),[s,m]=g.useState(null),[D,b]=g.useState(!0),[w,x]=g.useState(null),[f,p]=g.useState(30),{toast:F}=ae(),P=t.get("token"),X=!!P,H=async()=>{if(!P){x("Admin token required"),b(!1);return}try{const a=await fetch(`/api/analytics/stats?days=${f}`,{headers:{"X-Admin-Token":P}});if(!a.ok)throw a.status===401?new Error("Invalid admin token"):new Error(`HTTP error! status: ${a.status}`);const u=await a.json();m(u),x(null)}catch(a){console.error("Error fetching analytics:",a),x(a instanceof Error?a.message:"Failed to fetch analytics"),F({title:"Error",description:"Failed to fetch analytics data. Please check your admin token.",variant:"destructive"})}finally{b(!1)}};g.useEffect(()=>{H();const a=setInterval(H,6e4);return()=>clearInterval(a)},[f,P]);const C=()=>{b(!0),H()},I=a=>{if(!a)return"Unknown";try{return new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(u){return"Unknown"}},j=a=>new Intl.NumberFormat().format(a||0);return X?D&&!s?e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"text-lg",children:"Loading analytics..."})]})}):w&&!s?e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-destructive",children:"Error Loading Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:w}),e.jsxs(v,{onClick:C,variant:"outline",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Try Again"]}),e.jsx("div",{className:"mt-4",children:e.jsx(v,{asChild:!0,variant:"ghost",children:e.jsxs(J,{to:"/",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Back to Home"]})})})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-950 via-gray-900 to-black text-gray-100",children:[e.jsx("div",{className:"sticky top-0 z-50 w-full border-b border-gray-800 bg-gray-950/95 backdrop-blur",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex h-16 items-center justify-between px-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(v,{asChild:!0,variant:"ghost",size:"sm",className:"bg-gray-800 hover:bg-gray-700 text-gray-200 border-gray-700",children:e.jsxs(J,{to:"/",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Home"]})}),e.jsxs("div",{className:"hidden md:flex items-center gap-2 pl-4 border-l border-gray-700",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center",children:e.jsx(G,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-white",children:"Admin Analytics"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Veterans Benefits AI"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:f,onChange:a=>p(Number(a.target.value)),className:"h-9 px-3 text-sm border border-gray-700 rounded-md bg-gray-800 text-gray-200 focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:7,children:"Last 7 days"}),e.jsx("option",{value:30,children:"Last 30 days"}),e.jsx("option",{value:90,children:"Last 90 days"}),e.jsx("option",{value:365,children:"Last year"})]}),e.jsx(v,{onClick:C,size:"sm",disabled:D,className:"bg-gray-800 hover:bg-gray-700 text-gray-200 border border-gray-700",children:e.jsx(O,{className:`h-4 w-4 ${D?"animate-spin":""}`})}),e.jsxs(h,{className:"bg-orange-600 text-white border-0",children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"Admin"]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4",children:[s&&e.jsxs(we,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(me,{className:"grid w-full grid-cols-8 h-12 bg-gray-800 border border-gray-700",children:[e.jsxs(L,{value:"overview",className:"flex items-center gap-2 data-[state=active]:bg-gray-700 data-[state=active]:text-orange-500",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Overview"})]}),e.jsxs(L,{value:"locations",className:"flex items-center gap-2 data-[state=active]:bg-gray-700 data-[state=active]:text-orange-500",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Locations"})]}),e.jsxs(L,{value:"traffic",className:"flex items-center gap-2 data-[state=active]:bg-gray-700 data-[state=active]:text-orange-500",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Traffic"})]}),e.jsxs(L,{value:"tokens",className:"flex items-center gap-2 data-[state=active]:bg-gray-700 data-[state=active]:text-orange-500",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Tokens"})]}),e.jsxs(L,{value:"performance",className:"flex items-center gap-2 data-[state=active]:bg-gray-700 data-[state=active]:text-orange-500",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Performance"})]}),e.jsxs(L,{value:"cache",className:"flex items-center gap-2 data-[state=active]:bg-gray-700 data-[state=active]:text-orange-500",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Cache"})]}),e.jsxs(L,{value:"timeline",className:"flex items-center gap-2 data-[state=active]:bg-gray-700 data-[state=active]:text-orange-500",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Timeline"})]}),e.jsxs(L,{value:"flagged",className:"flex items-center gap-2 data-[state=active]:bg-gray-700 data-[state=active]:text-orange-500",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Flagged"})]})]}),e.jsxs(A,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Total Pageviews"}),e.jsx(ee,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:j(s.totals.pageviews)}),e.jsx("p",{className:"text-xs text-gray-400",children:"All-time page views"})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Unique Visitors"}),e.jsx(je,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:j(s.totals.uniques)}),e.jsx("p",{className:"text-xs text-gray-400",children:"Individual users tracked"})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Chat Questions"}),e.jsx(se,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:j(s.totals.chat_questions)}),e.jsx("p",{className:"text-xs text-gray-400",children:"AI questions processed"})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Engagement Rate"}),e.jsx($,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:[s.service_info.engagement_rate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Questions per visit"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsx(n,{className:"text-gray-200",children:"Service Performance"}),e.jsx(y,{className:"text-gray-400",children:"Key performance indicators"})]}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Questions per User:"}),e.jsx(h,{className:"bg-gray-700 text-orange-500 border-gray-600",children:s.service_info.questions_per_user.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Total Locations Tracked:"}),e.jsx(h,{className:"bg-gray-700 text-orange-500 border-gray-600",children:j(s.visitor_locations.total_tracked)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Service Started:"}),e.jsx("span",{className:"text-sm text-gray-400",children:I(s.service_info.first_visit)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Last Updated:"}),e.jsx("span",{className:"text-sm text-gray-400",children:I(s.service_info.last_updated)})]})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsx(n,{className:"text-gray-200",children:"Geographic Distribution"}),e.jsx(y,{className:"text-gray-400",children:"Visitor location breakdown"})]}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"US States:"}),e.jsxs(h,{className:"bg-orange-600 text-white",children:[Object.keys(s.visitor_locations.us_states).length," states"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"International:"}),e.jsxs(h,{className:"bg-gray-700 text-gray-300 border-gray-600",children:[j(s.visitor_locations.international)," visitors"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Local/Development:"}),e.jsxs(h,{className:"bg-gray-700 text-gray-300 border-gray-600",children:[j(s.visitor_locations.local)," visits"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Unknown Location:"}),e.jsxs(h,{className:"bg-gray-700 text-gray-300 border-gray-600",children:[j(s.visitor_locations.unknown)," visits"]})]})]})]})]})]}),e.jsx(A,{value:"locations",className:"space-y-6",children:e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex items-center space-x-2 text-gray-200",children:[e.jsx(Ne,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{children:"Visitor Locations Heat Map"})]}),e.jsx(y,{className:"text-gray-400",children:"Geographic distribution of website visitors across the United States"})]}),e.jsx(i,{children:e.jsx(g.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Loading map..."})}),children:e.jsx(pe,{})})})]})}),e.jsx(A,{value:"traffic",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex items-center space-x-2 text-gray-200",children:[e.jsx(G,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{children:"Top Pages"})]}),e.jsxs(y,{className:"text-gray-400",children:["Most visited pages (last ",f," days)"]})]}),e.jsx(i,{children:e.jsxs(S,{children:[e.jsx(R,{children:e.jsxs(N,{className:"border-gray-700",children:[e.jsx(o,{className:"text-gray-400",children:"Page"}),e.jsx(o,{className:"text-right text-gray-400",children:"Views"})]})}),e.jsx(U,{children:s.top_pages.length===0?e.jsx(N,{className:"border-gray-700",children:e.jsx(d,{colSpan:2,className:"text-center text-gray-500",children:"No page data available"})}):s.top_pages.map((a,u)=>e.jsxs(N,{className:"border-gray-700",children:[e.jsx(d,{className:"font-medium text-gray-300",children:a.path||"(homepage)"}),e.jsx(d,{className:"text-right text-orange-500",children:j(a.pageviews)})]},u))})]})})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex items-center space-x-2 text-gray-200",children:[e.jsx(te,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{children:"Top Referrers"})]}),e.jsxs(y,{className:"text-gray-400",children:["Traffic sources (last ",f," days)"]})]}),e.jsx(i,{children:e.jsxs(S,{children:[e.jsx(R,{children:e.jsxs(N,{className:"border-gray-700",children:[e.jsx(o,{className:"text-gray-400",children:"Referrer"}),e.jsx(o,{className:"text-right text-gray-400",children:"Visits"})]})}),e.jsx(U,{children:s.top_referrers.length===0?e.jsx(N,{className:"border-gray-700",children:e.jsx(d,{colSpan:2,className:"text-center text-gray-500",children:"No referrer data available"})}):s.top_referrers.map((a,u)=>e.jsxs(N,{className:"border-gray-700",children:[e.jsx(d,{className:"font-medium text-gray-300",children:a.referrer==="(direct)"?"Direct Traffic":a.referrer}),e.jsx(d,{className:"text-right text-orange-500",children:j(a.visits)})]},u))})]})})]})]})}),e.jsx(A,{value:"tokens",className:"space-y-6",children:(Q=s.token_usage)!=null&&Q.available?e.jsxs(e.Fragment,{children:[((B=s.token_usage)==null?void 0:B.summary)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Total Tokens"}),e.jsx(z,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:j(s.token_usage.summary.total_tokens||0)}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Over ",s.token_usage.summary.queries_with_tokens||0," queries"]})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Avg per Query"}),e.jsx(re,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:Math.round(s.token_usage.summary.avg_tokens_per_query||0)}),e.jsx("p",{className:"text-xs text-gray-400",children:"Tokens per question"})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Prompt Tokens"}),e.jsx(se,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:j(s.token_usage.summary.total_prompt_tokens||0)}),e.jsx("p",{className:"text-xs text-gray-400",children:"Input processing"})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Completion Tokens"}),e.jsx(ee,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:j(s.token_usage.summary.total_completion_tokens||0)}),e.jsx("p",{className:"text-xs text-gray-400",children:"Response generation"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[((V=s.token_usage)==null?void 0:V.model_breakdown)&&s.token_usage.model_breakdown.length>0&&e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex items-center space-x-2 text-gray-200",children:[e.jsx(re,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{children:"Model Usage"})]}),e.jsx(y,{className:"text-gray-400",children:"Token consumption by AI model"})]}),e.jsx(i,{children:e.jsxs(S,{children:[e.jsx(R,{children:e.jsxs(N,{className:"border-gray-700",children:[e.jsx(o,{className:"text-gray-400",children:"Model"}),e.jsx(o,{className:"text-gray-400",children:"Provider"}),e.jsx(o,{className:"text-right text-gray-400",children:"Uses"}),e.jsx(o,{className:"text-right text-gray-400",children:"Total Tokens"}),e.jsx(o,{className:"text-right text-gray-400",children:"Avg"})]})}),e.jsx(U,{children:s.token_usage.model_breakdown.map((a,u)=>e.jsxs(N,{className:"border-gray-700",children:[e.jsx(d,{className:"font-medium text-gray-300",children:a.model_used||"Unknown"}),e.jsx(d,{children:e.jsx(h,{className:"bg-gray-700 text-gray-300 border-gray-600",children:a.api_provider||"Unknown"})}),e.jsx(d,{className:"text-right text-gray-300",children:j(a.usage_count)}),e.jsx(d,{className:"text-right text-orange-500",children:j(a.total_tokens||0)}),e.jsx(d,{className:"text-right text-gray-300",children:Math.round(a.avg_tokens||0)})]},u))})]})})]}),((c=s.token_usage)==null?void 0:c.daily_usage)&&s.token_usage.daily_usage.length>0&&e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex items-center space-x-2 text-gray-200",children:[e.jsx(Z,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{children:"Daily Token Usage"})]}),e.jsxs(y,{className:"text-gray-400",children:["Token consumption over time (last ",f," days)"]})]}),e.jsx(i,{children:e.jsxs(S,{children:[e.jsx(R,{children:e.jsxs(N,{className:"border-gray-700",children:[e.jsx(o,{className:"text-gray-400",children:"Date"}),e.jsx(o,{className:"text-right text-gray-400",children:"Queries"}),e.jsx(o,{className:"text-right text-gray-400",children:"Total Tokens"}),e.jsx(o,{className:"text-right text-gray-400",children:"Avg"})]})}),e.jsx(U,{children:s.token_usage.daily_usage.slice(0,10).map((a,u)=>e.jsxs(N,{className:"border-gray-700",children:[e.jsx(d,{className:"font-medium text-gray-300",children:new Date(a.day).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(d,{className:"text-right text-gray-300",children:j(a.queries)}),e.jsx(d,{className:"text-right text-orange-500",children:j(a.daily_tokens)}),e.jsx(d,{className:"text-right text-gray-300",children:Math.round(a.avg_tokens||0)})]},u))})]})})]})]}),((_=s.token_usage)==null?void 0:_.summary)&&e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsx(n,{className:"text-gray-200",children:"Token Usage Insights"}),e.jsx(y,{className:"text-gray-400",children:"AI resource consumption analysis"})]}),e.jsx(i,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:s.token_usage.summary.unique_models||0}),e.jsx("p",{className:"text-sm text-gray-400",children:"AI Models Used"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:s.token_usage.summary.unique_providers||0}),e.jsx("p",{className:"text-sm text-gray-400",children:"API Providers"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:[((s.token_usage.summary.total_completion_tokens||0)/Math.max(s.token_usage.summary.total_tokens||1,1)*100).toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Response Ratio"})]})]})})]})]}):e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex items-center space-x-2 text-gray-200",children:[e.jsx(z,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{children:"Token Usage Tracking"})]}),e.jsx(y,{className:"text-gray-400",children:"AI token consumption analytics"})]}),e.jsx(i,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"h-12 w-12 mx-auto text-gray-500 mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-300 mb-2",children:"Token Tracking Not Available"}),e.jsx("p",{className:"text-sm text-gray-400",children:((k=s.token_usage)==null?void 0:k.message)||((E=s.token_usage)==null?void 0:E.error)||"Token usage tracking is being set up. Check back shortly."})]})})]})}),e.jsx(A,{value:"performance",className:"space-y-6",children:s.performance?s.performance.available?e.jsxs(e.Fragment,{children:[s.performance.summary&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Avg Response Time"}),e.jsx($,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:[Math.round(s.performance.summary.avg_ms||0)," ms"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Average over last ",f," days"]})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"p95 Response Time"}),e.jsx($,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:[Math.round(s.performance.summary.p95_ms||0)," ms"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"95th percentile"})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Success Rate"}),e.jsx($,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:[((s.performance.summary.success_rate||0)*100).toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Successful responses"})]})]}),e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-300",children:"Avg Answer Size"}),e.jsx(G,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:[Math.round(s.performance.summary.avg_answer_chars||0)," chars"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Response length"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.performance.by_provider&&s.performance.by_provider.length>0&&e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsx(n,{className:"text-gray-200",children:"Performance by Provider"}),e.jsx(y,{className:"text-gray-400",children:"Comparative performance metrics"})]}),e.jsx(i,{children:e.jsxs(S,{children:[e.jsx(R,{children:e.jsxs(N,{className:"border-gray-700",children:[e.jsx(o,{className:"text-gray-400",children:"Provider"}),e.jsx(o,{className:"text-right text-gray-400",children:"Avg ms"}),e.jsx(o,{className:"text-right text-gray-400",children:"p95 ms"}),e.jsx(o,{className:"text-right text-gray-400",children:"Success"}),e.jsx(o,{className:"text-right text-gray-400",children:"Queries"})]})}),e.jsx(U,{children:s.performance.by_provider.map((a,u)=>e.jsxs(N,{className:"border-gray-700",children:[e.jsx(d,{className:"font-medium text-gray-300",children:a.provider}),e.jsx(d,{className:"text-right text-orange-500",children:Math.round(a.avg_ms||0)}),e.jsx(d,{className:"text-right text-orange-500",children:Math.round(a.p95_ms||0)}),e.jsxs(d,{className:"text-right text-gray-300",children:[((a.success_rate||0)*100).toFixed(1),"%"]}),e.jsx(d,{className:"text-right text-gray-300",children:a.queries})]},u))})]})})]}),s.performance.daily&&s.performance.daily.length>0&&e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsx(n,{className:"text-gray-200",children:"Daily Performance"}),e.jsx(y,{className:"text-gray-400",children:"Average and p95 response times"})]}),e.jsx(i,{children:e.jsxs(S,{children:[e.jsx(R,{children:e.jsxs(N,{className:"border-gray-700",children:[e.jsx(o,{className:"text-gray-400",children:"Date"}),e.jsx(o,{className:"text-right text-gray-400",children:"Avg ms"}),e.jsx(o,{className:"text-right text-gray-400",children:"p95 ms"}),e.jsx(o,{className:"text-right text-gray-400",children:"Queries"})]})}),e.jsx(U,{children:s.performance.daily.slice(0,10).map((a,u)=>e.jsxs(N,{className:"border-gray-700",children:[e.jsx(d,{className:"font-medium text-gray-300",children:new Date(a.day).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(d,{className:"text-right text-orange-500",children:Math.round(a.avg_ms||0)}),e.jsx(d,{className:"text-right text-orange-500",children:Math.round(a.p95_ms||0)}),e.jsx(d,{className:"text-right text-gray-300",children:a.queries})]},u))})]})})]})]})]}):e.jsx(r,{className:"bg-gray-800/50 border-gray-700",children:e.jsxs(l,{children:[e.jsx(n,{className:"text-gray-200",children:"Performance Analytics"}),e.jsx(y,{className:"text-gray-400",children:s.performance.message||s.performance.error||"Performance data not yet available."})]})}):null}),e.jsx(Ce,{adminToken:P}),e.jsxs(A,{value:"timeline",className:"space-y-6",children:[e.jsxs(r,{className:"bg-gray-800/50 border-gray-700",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex items-center space-x-2 text-gray-200",children:[e.jsx(Z,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{children:"Daily Activity Timeline"})]}),e.jsxs(y,{className:"text-gray-400",children:["Daily breakdown of pageviews, unique visitors, and chat questions (last ",f," days)"]})]}),e.jsx(i,{children:e.jsxs(S,{children:[e.jsx(R,{children:e.jsxs(N,{className:"border-gray-700",children:[e.jsx(o,{className:"text-gray-400",children:"Date"}),e.jsx(o,{className:"text-right text-gray-400",children:"Pageviews"}),e.jsx(o,{className:"text-right text-gray-400",children:"Unique Visitors"}),e.jsx(o,{className:"text-right text-gray-400",children:"Chat Questions"})]})}),e.jsx(U,{children:s.by_day.length===0?e.jsx(N,{className:"border-gray-700",children:e.jsx(d,{colSpan:4,className:"text-center text-gray-500",children:"No daily data available for the selected period"})}):s.by_day.map((a,u)=>e.jsxs(N,{className:"border-gray-700",children:[e.jsx(d,{className:"font-medium text-gray-300",children:new Date(a.day).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),e.jsx(d,{className:"text-right text-orange-500",children:j(a.pageviews)}),e.jsx(d,{className:"text-right text-orange-500",children:j(a.uniques)}),e.jsx(d,{className:"text-right text-orange-500",children:j(a.chat_questions)})]},u))})]})})]}),e.jsx(Te,{})]}),e.jsx(A,{value:"flagged",className:"space-y-6",children:e.jsxs(r,{className:"bg-slate-800/50 border-slate-700",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex items-center space-x-2 text-orange-500",children:[e.jsx(Y,{className:"h-5 w-5"}),e.jsx("span",{children:"Flagged Responses"})]}),e.jsx(y,{children:"Responses flagged for potential hallucinations, weak retrieval, or suspicious citations. Review these entries to improve corpus quality and RAG accuracy."})]}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(r,{className:"bg-red-900/20 border-red-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-red-400",children:"Weak Retrievals"}),e.jsx(Y,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-500",children:"--"}),e.jsx("p",{className:"text-xs text-red-400/70",children:"Best chunk score < 0.55"})]})]}),e.jsxs(r,{className:"bg-yellow-900/20 border-yellow-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-yellow-400",children:"Suspicious Citations"}),e.jsx(ne,{className:"h-4 w-4 text-yellow-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:"--"}),e.jsx("p",{className:"text-xs text-yellow-400/70",children:"Citation verification failed"})]})]}),e.jsxs(r,{className:"bg-orange-900/20 border-orange-700",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-orange-400",children:"Invalid URLs"}),e.jsx(te,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:"--"}),e.jsx("p",{className:"text-xs text-orange-400/70",children:"URLs not in whitelist"})]})]})]}),e.jsx(r,{className:"bg-slate-700/30 border-slate-600",children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(K,{className:"h-8 w-8 text-orange-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-orange-500 mb-2",children:"Hallucination Prevention System"}),e.jsx("p",{className:"text-sm text-gray-300 mb-3",children:"The RAG pipeline now includes multiple layers of hallucination detection:"}),e.jsxs("ul",{className:"text-sm text-gray-400 space-y-2",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Relevance Threshold:"})," Chunks below 0.45 similarity are rejected"]})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{children:[e.jsx("strong",{children:"URL Validation:"})," All source URLs verified against whitelist"]})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Citation Verification:"})," Claims cross-checked with source chunks"]})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Explicit Boundaries:"})," Context chunks clearly delimited for LLM"]})]})]})]})]})})}),e.jsxs(r,{className:"bg-slate-700/30 border-slate-600",children:[e.jsx(l,{children:e.jsx(n,{className:"text-sm text-gray-300",children:"Recent Flagged Entries"})}),e.jsx(i,{children:e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(Y,{className:"h-12 w-12 mx-auto mb-4 text-gray-500"}),e.jsx("p",{children:"Flagged response logging is now active."}),e.jsx("p",{className:"text-sm mt-2",children:"Responses with weak retrieval or citation issues will appear here."})]})})]})]})})]})})]}),e.jsxs("div",{className:"text-center mt-12 text-gray-500",children:[e.jsx("p",{children:"Veterans Benefits AI - Admin Analytics Dashboard"}),e.jsxs("p",{className:"text-sm mt-1",children:["Data refreshes automatically every minute â€¢ Last updated: ",s!=null&&s.service_info.last_updated?I(s.service_info.last_updated):"Unknown"]})]})]})]}):e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:e.jsxs(r,{className:"w-full max-w-md mx-4 border-slate-700 bg-slate-800/50 backdrop-blur",children:[e.jsxs(l,{className:"text-center space-y-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gradient-to-br from-amber-500 to-orange-600 rounded-full flex items-center justify-center",children:e.jsx(K,{className:"h-8 w-8 text-white"})}),e.jsx(n,{className:"text-2xl text-white",children:"Admin Access Required"}),e.jsx(y,{className:"text-slate-400",children:"This dashboard requires authentication to access sensitive analytics data."})]}),e.jsxs(i,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{children:"Access URL format:"})]}),e.jsx("code",{className:"block p-3 bg-slate-900/50 rounded-lg text-amber-400 text-sm font-mono",children:"/admin/analytics?token=YOUR_TOKEN"})]}),e.jsx("div",{className:"pt-4 border-t border-slate-700",children:e.jsx(v,{asChild:!0,variant:"outline",className:"w-full border-slate-600 hover:bg-slate-700",children:e.jsxs(J,{to:"/",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Back to Home"]})})})]})]})})};export{Pe as default};
