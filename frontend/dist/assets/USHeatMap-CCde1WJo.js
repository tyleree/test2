import{r as l,k as e}from"./vendor-Cye-Yv4e.js";import{C as A,G as I,a as L}from"./vendor-maps-EtJUnHl2.js";import{C as h,a as f,b as j,d as g}from"./card-Ceez92Pw.js";import{B as v}from"./badge-DFOnridc.js";import{l as O}from"./vendor-charts-B_ZyQ9af.js";import"./vendor-ui-DWFxUGAD.js";import"./index-Uwbr45-t.js";import"./vendor-router-BYblEMJK.js";const H="https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json",b={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"},G=({className:c})=>{const[r,y]=l.useState(null),[S,w]=l.useState(!0),[d,N]=l.useState(null),[o,p]=l.useState(null);if(l.useEffect(()=>{const s=async()=>{try{const t=await fetch("/api/locations");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();console.log("ðŸ—ºï¸ Heat map received location data:",n),console.log("ðŸ—ºï¸ US states data:",n.us_states),console.log("ðŸ—ºï¸ Available state codes:",Object.keys(n.us_states||{})),y(n),N(null)}catch(t){console.error("Error fetching location data:",t),N(t instanceof Error?t.message:"Failed to fetch location data")}finally{w(!1)}};s();const a=setInterval(s,3e4);return()=>clearInterval(a)},[]),S)return e.jsxs(h,{className:c,children:[e.jsx(f,{children:e.jsx(j,{children:"Visitor Locations"})}),e.jsx(g,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Loading map..."})})})]});if(d||!r)return e.jsxs(h,{className:c,children:[e.jsx(f,{children:e.jsx(j,{children:"Visitor Locations"})}),e.jsx(g,{children:e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:d?`Error: ${d}`:"No location data available"})})]});const i=Object.values(r.us_states),x=i.length>0?Math.max(...i):1,M=i.length>0?Math.min(...i.filter(s=>s>0)):0;console.log("ðŸŽ¨ Heat map color scale:",{maxCount:x,minCount:M,stateValues:i});const C=O().domain([0,x]).range(["#e0e7ff","#3b82f6"]),m=s=>{if(!s||!r)return 0;const a=[s.toUpperCase(),s.toLowerCase(),s];for(const t of a)if(r.us_states[t]!==void 0)return r.us_states[t];return 0},u=s=>{const a=m(s);return a===0?"#f8fafc":C(a)};return e.jsxs(h,{className:c,children:[e.jsx(f,{children:e.jsxs(j,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Visitor Locations"}),e.jsxs(v,{variant:"secondary",className:"text-xs",children:[r.total_tracked," tracked"]})]})}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(A,{projection:"geoAlbersUsa",projectionConfig:{scale:1e3},width:800,height:500,className:"w-full h-auto",children:e.jsx(I,{geography:H,children:({geographies:s})=>s.map(a=>{const t=a.properties.STUSPS,n=m(t),k=o===t;return a.rsmKey&&parseInt(a.rsmKey)<5&&console.log(`ðŸ—ºï¸ State ${t}:`,{stateCode:t,count:n,color:u(t),availableStates:Object.keys(r.us_states)}),e.jsx(L,{geography:a,fill:u(t),stroke:"#ffffff",strokeWidth:.5,style:{default:{outline:"none"},hover:{fill:k?"#1d4ed8":u(t),outline:"none",strokeWidth:1},pressed:{outline:"none"}},onMouseEnter:()=>p(t),onMouseLeave:()=>p(null)},a.rsmKey)})})}),o&&e.jsxs("div",{className:"absolute top-4 left-4 bg-background border rounded-lg p-3 shadow-lg z-10",children:[e.jsx("div",{className:"font-semibold",children:b[o]||o}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[m(o)," visitors"]})]})]}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-slate-100 border rounded"}),e.jsx("span",{className:"text-muted-foreground",children:"0 visitors"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-200 rounded"}),e.jsx("span",{className:"text-muted-foreground",children:"Low"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded"}),e.jsxs("span",{className:"text-muted-foreground",children:["High (",x,")"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-blue-600",children:Object.keys(r.us_states).length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"States Visited"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-green-600",children:Object.values(r.us_states).reduce((s,a)=>s+a,0)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"US Visitors"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-purple-600",children:r.international}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"International"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-orange-600",children:r.local+r.unknown}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Local/Unknown"})]})]}),Object.keys(r.us_states).length>0&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Top States"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:Object.entries(r.us_states).sort(([,s],[,a])=>a-s).slice(0,6).map(([s,a])=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"font-medium",children:b[s]||s}),e.jsx(v,{variant:"outline",className:"text-xs",children:a})]},s))})]})]})})]})};export{G as USHeatMap,G as default};
