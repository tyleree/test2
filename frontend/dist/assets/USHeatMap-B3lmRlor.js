import{k as e,D as I,r as c}from"./vendor-BzTNOEb7.js";import{C as k,G as D,a as L}from"./vendor-maps-Cr_Lmh8h.js";import{C as h,a as f,b as g,d as j}from"./card-D-yT7lwl.js";import{c as O}from"./index-D6qTrqxi.js";import{l as T}from"./vendor-charts-B_ZyQ9af.js";const V=I("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function b({className:o,variant:a,...d}){return e.jsx("div",{className:O(V({variant:a}),o),...d})}const H="/static/us-states.json",E={"01":"AL","02":"AK","04":"AZ","05":"AR","06":"CA","08":"CO","09":"CT",10:"DE",11:"DC",12:"FL",13:"GA",15:"HI",16:"ID",17:"IL",18:"IN",19:"IA",20:"KS",21:"KY",22:"LA",23:"ME",24:"MD",25:"MA",26:"MI",27:"MN",28:"MS",29:"MO",30:"MT",31:"NE",32:"NV",33:"NH",34:"NJ",35:"NM",36:"NY",37:"NC",38:"ND",39:"OH",40:"OK",41:"OR",42:"PA",44:"RI",45:"SC",46:"SD",47:"TN",48:"TX",49:"UT",50:"VT",51:"VA",53:"WA",54:"WV",55:"WI",56:"WY",72:"PR"},M={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",DC:"District of Columbia",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming",PR:"Puerto Rico"},P=({className:o})=>{const[a,d]=c.useState(null),[C,y]=c.useState(!0),[x,N]=c.useState(null),[i,v]=c.useState(null);if(c.useEffect(()=>{const s=async()=>{try{const r=await fetch("/api/locations");if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const n=await r.json();console.log("ðŸ—ºï¸ Heat map received location data:",n),console.log("ðŸ—ºï¸ US states data:",n.us_states),console.log("ðŸ—ºï¸ Available state codes:",Object.keys(n.us_states||{})),d(n),N(null)}catch(r){console.error("Error fetching location data:",r),N(r instanceof Error?r.message:"Failed to fetch location data")}finally{y(!1)}};s();const t=setInterval(s,3e4);return()=>clearInterval(t)},[]),C)return e.jsxs(h,{className:o,children:[e.jsx(f,{children:e.jsx(g,{children:"Visitor Locations"})}),e.jsx(j,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Loading map..."})})})]});if(x||!a)return e.jsxs(h,{className:o,children:[e.jsx(f,{children:e.jsx(g,{children:"Visitor Locations"})}),e.jsx(j,{children:e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:x?`Error: ${x}`:"No location data available"})})]});const l=Object.values(a.us_states),u=l.length>0?Math.max(...l):1,A=l.length>0?Math.min(...l.filter(s=>s>0)):0;console.log("ðŸŽ¨ Heat map color scale:",{maxCount:u,minCount:A,stateValues:l});const S=T().domain([0,u]).range(["#e0e7ff","#3b82f6"]),m=s=>{if(!s||!a)return 0;const t=[s.toUpperCase(),s.toLowerCase(),s];for(const r of t)if(a.us_states[r]!==void 0)return a.us_states[r];return 0},p=s=>{const t=m(s);return t===0?"#f8fafc":S(t)};return e.jsxs(h,{className:o,children:[e.jsx(f,{children:e.jsxs(g,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Visitor Locations"}),e.jsxs(b,{variant:"secondary",className:"text-xs",children:[a.total_tracked," tracked"]})]})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(k,{projection:"geoAlbersUsa",projectionConfig:{scale:1e3},width:800,height:500,className:"w-full h-auto",children:e.jsx(D,{geography:H,children:({geographies:s})=>s.map(t=>{const r=t.id,n=E[r]||r;m(n);const w=i===n;return e.jsx(L,{geography:t,fill:p(n),stroke:"#ffffff",strokeWidth:.5,style:{default:{outline:"none"},hover:{fill:w?"#1d4ed8":p(n),outline:"none",strokeWidth:1},pressed:{outline:"none"}},onMouseEnter:()=>v(n),onMouseLeave:()=>v(null)},t.rsmKey)})})}),i&&e.jsxs("div",{className:"absolute top-4 left-4 bg-background border rounded-lg p-3 shadow-lg z-10",children:[e.jsx("div",{className:"font-semibold",children:M[i]||i}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[m(i)," visitors"]})]})]}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-slate-100 border rounded"}),e.jsx("span",{className:"text-muted-foreground",children:"0 visitors"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-200 rounded"}),e.jsx("span",{className:"text-muted-foreground",children:"Low"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded"}),e.jsxs("span",{className:"text-muted-foreground",children:["High (",u,")"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-blue-600",children:Object.keys(a.us_states).length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"States Visited"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-green-600",children:Object.values(a.us_states).reduce((s,t)=>s+t,0)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"US Visitors"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-purple-600",children:a.international}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"International"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-orange-600",children:a.local+a.unknown}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Local/Unknown"})]})]}),Object.keys(a.us_states).length>0&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Top States"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:Object.entries(a.us_states).sort(([,s],[,t])=>t-s).slice(0,6).map(([s,t])=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"font-medium",children:M[s]||s}),e.jsx(b,{variant:"outline",className:"text-xs",children:t})]},s))})]})]})})]})};export{b as B,P as U};
