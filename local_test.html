<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veterans Benefits AI - Trusted data, free forever</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            900: '#14532d'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'pulse-slow': 'pulse 3s infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'float': 'float 3s ease-in-out infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        glow: {
                            '0%': { textShadow: '0 0 5px #22c55e, 0 0 10px #22c55e, 0 0 15px #22c55e' },
                            '100%': { textShadow: '0 0 10px #22c55e, 0 0 20px #22c55e, 0 0 30px #22c55e' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }
        .hero-gradient {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }
        .card-gradient {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        }
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .title-shadow {
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5), 0 8px 16px rgba(0, 0, 0, 0.3);
        }
        .tagline-shadow {
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4), 0 4px 8px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen">
    <!-- Hero Section -->
    <div class="hero-gradient text-white">
        <div class="container mx-auto px-4 py-20">
            <div class="text-center max-w-4xl mx-auto">
                <h1 class="text-5xl md:text-7xl font-bold mb-6 animate-fade-in title-shadow">
                    <span class="bg-gradient-to-r from-green-400 to-green-600 bg-clip-text text-transparent animate-glow">
                        Veterans Benefits AI
                    </span>
                </h1>
                <p class="text-xl md:text-2xl mb-8 text-green-300 animate-slide-up tagline-shadow animate-float">
                    Trusted data, free forever
                </p>
                <div class="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-6 max-w-2xl mx-auto animate-slide-up border border-gray-700">
                    <p class="text-lg text-gray-200">
                        Get instant, accurate answers about VA benefits with AI-powered assistance backed by official sources.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-16">
        <!-- Status Cards -->
        <div class="grid md:grid-cols-3 gap-6 mb-12">
            <div class="bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-700 hover:shadow-xl hover:shadow-green-500/20 transition-all duration-300 hover:scale-105">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-green-900 rounded-full flex items-center justify-center">
                        <span class="text-2xl">‚úÖ</span>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-100">Local Testing</h3>
                        <p class="text-gray-400 text-sm">No server required</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-700 hover:shadow-xl hover:shadow-green-500/20 transition-all duration-300 hover:scale-105">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-green-900 rounded-full flex items-center justify-center">
                        <span class="text-2xl">üè†</span>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-100">Offline Capable</h3>
                        <p class="text-gray-400 text-sm">Works without internet</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-700 hover:shadow-xl hover:shadow-green-500/20 transition-all duration-300 hover:scale-105">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-green-900 rounded-full flex items-center justify-center">
                        <span class="text-2xl">üöÄ</span>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-100">Instant Results</h3>
                        <p class="text-gray-400 text-sm">Mock data for testing</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Interface Card -->
        <div class="bg-gray-800 rounded-3xl shadow-2xl p-8 max-w-4xl mx-auto border border-gray-700">
            <!-- Mock Data Toggle -->
            <div class="text-center mb-8">
                <button id="mockToggle" onclick="toggleMockData()" 
                        class="px-6 py-3 rounded-full font-medium transition-all duration-300 hover:scale-105 bg-gray-700 text-gray-200 hover:bg-gray-600">
                    Enable Mock Data Mode
                </button>
            </div>

            <!-- Input Section -->
            <div class="space-y-6">
                <div class="relative">
                    <textarea id="prompt" 
                              placeholder="Ask a question about veterans benefits..."
                              class="w-full h-32 p-6 text-lg border-2 border-gray-600 rounded-2xl resize-none focus:border-green-500 focus:ring-4 focus:ring-green-500/20 transition-all duration-300 font-medium bg-gray-700 text-gray-100 placeholder-gray-400"></textarea>
                    
                    <!-- Typing Indicator -->
                    <div id="typingIndicator" class="absolute top-6 right-6 hidden">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-green-500 rounded-full typing-dot"></div>
                            <div class="w-2 h-2 bg-green-500 rounded-full typing-dot"></div>
                            <div class="w-2 h-2 bg-green-500 rounded-full typing-dot"></div>
                        </div>
                    </div>
                </div>

                <div class="text-center">
                    <button onclick="ask()" id="askButton" 
                            class="px-8 py-4 bg-gradient-to-r from-green-600 to-green-700 text-white text-lg font-semibold rounded-2xl hover:from-green-700 hover:to-green-800 transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl hover:shadow-green-500/30">
                        Ask Question
                    </button>
                </div>
            </div>

            <!-- Sample Questions -->
            <div class="mt-8 pt-6 border-t border-gray-700">
                <p class="text-center text-gray-400 mb-4 font-medium">Try these sample questions:</p>
                <div class="flex flex-wrap justify-center gap-3">
                    <button onclick="setSampleQuestion('How do I apply for VA disability benefits?')" 
                            class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-200 rounded-full text-sm font-medium transition-colors duration-200 hover:shadow-lg hover:shadow-green-500/20">
                        Disability Benefits
                    </button>
                    <button onclick="setSampleQuestion('What are the requirements for VA pension?')" 
                            class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-200 rounded-full text-sm font-medium transition-colors duration-200 hover:shadow-lg hover:shadow-green-500/20">
                        Pension Requirements
                    </button>
                    <button onclick="setSampleQuestion('How do I use my GI Bill for education?')" 
                            class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-200 rounded-full text-sm font-medium transition-colors duration-200 hover:shadow-lg hover:shadow-green-500/20">
                        GI Bill Education
                    </button>
                </div>
            </div>
        </div>

        <!-- Response Section -->
        <div id="response" class="mt-12 max-w-4xl mx-auto hidden">
            <div class="bg-gray-800 rounded-3xl shadow-xl p-8 border border-gray-700">
                <div class="prose prose-lg max-w-none prose-invert">
                    <!-- Response content will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Citations Section -->
        <div id="refs" class="mt-8 max-w-4xl mx-auto hidden">
            <div class="bg-gray-800 rounded-3xl shadow-xl p-8 border border-gray-700">
                <h3 class="text-2xl font-bold text-gray-100 mb-6 text-center">Sources & Footnotes</h3>
                <div class="space-y-4">
                    <!-- Citations will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="bg-gray-950 text-white py-12 mt-20 border-t border-gray-800">
        <div class="container mx-auto px-4 text-center">
            <h3 class="text-2xl font-bold mb-4 text-green-400">Veterans Benefits AI</h3>
            <p class="text-gray-400 mb-6">Empowering veterans with trusted information and AI assistance</p>
            <div class="flex justify-center space-x-6 text-sm text-gray-500">
                <span>¬© 2024 Veterans Benefits AI</span>
                <span>‚Ä¢</span>
                <span>Free Forever</span>
                <span>‚Ä¢</span>
                <span>Trusted Data</span>
            </div>
        </div>
    </div>

    <script>
        // Global variables and functions
        let mockDataMode = false;
        
        // Make functions globally accessible
        window.toggleMockData = function() {
            mockDataMode = !mockDataMode;
            console.log('Mock data mode:', mockDataMode);
            const button = document.getElementById('mockToggle');
            if (mockDataMode) {
                button.textContent = 'Disable Mock Data Mode';
                button.className = 'px-6 py-3 rounded-full font-medium transition-all duration-300 hover:scale-105 bg-green-700 text-white hover:bg-green-600';
            } else {
                button.textContent = 'Enable Mock Data Mode';
                button.className = 'px-6 py-3 rounded-full font-medium transition-all duration-300 hover:scale-105 bg-gray-700 text-gray-200 hover:bg-gray-600';
            }
        };
        
        window.setSampleQuestion = function(question) {
            document.getElementById('prompt').value = question;
        };
        
        window.ask = async function() {
            const prompt = document.getElementById('prompt').value.trim();
            if (!prompt) {
                alert('Please enter a question');
                return;
            }

            const button = document.getElementById('askButton');
            const responseDiv = document.getElementById('response');
            const refsDiv = document.getElementById('refs');

            // Show loading state
            button.disabled = true;
            button.innerHTML = '<svg class="loading-spinner w-5 h-5 mr-2 inline" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Processing...';
            responseDiv.style.display = 'block';
            responseDiv.querySelector('.prose').innerHTML = '<div class="text-center text-gray-400 italic">Processing your question...</div>';
            refsDiv.style.display = 'none';

            try {
                console.log('Mock data mode:', mockDataMode);
                if (mockDataMode) {
                    console.log('Using mock data');
                    const mockResponse = generateMockResponse(prompt);
                    console.log('Generated mock response:', mockResponse);
                    displayResponse(mockResponse, responseDiv, refsDiv);
                } else {
                    try {
                        const res = await fetch('/ask', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({prompt})
                        });
                        
                        if (!res.ok) {
                            throw new Error(`HTTP error! status: ${res.status}`);
                        }
                        
                        const data = await res.json();
                        displayResponse(data, responseDiv, refsDiv);
                    } catch (error) {
                        console.log('Server not available, using mock data:', error.message);
                        const mockResponse = generateMockResponse(prompt);
                        displayResponse(mockResponse, responseDiv, refsDiv);
                    }
                }
            } catch (error) {
                responseDiv.querySelector('.prose').innerHTML = `<div class="text-red-400 font-semibold">Error: ${error.message}</div>`;
                console.error('Error:', error);
            } finally {
                button.disabled = false;
                button.innerHTML = 'Ask Question';
            }
        };
        
        function generateMockResponse(prompt) {
            const mockResponses = {
                'disability': {
                    content: `### **VA Disability Benefits Application Process**

To apply for VA disability benefits, you need to meet certain requirements and gather specific documentation. Here's a step-by-step guide:

#### **Eligibility Requirements**
1. **Chronic Disability**: You must have a chronic disability that:
   - Resulted from your military service
   - Was a preexisting condition worsened by your military service
   - Was caused by an already service-connected disability

2. **Character of Discharge**: Your discharge must be Honorable or General, Under Honorable Conditions

3. **Service Type**: You must have served on Active Duty, Active Duty for Training (ADT), or Inactive Duty Training (IADT)

#### **Required Documentation**
- Statement of symptoms or current diagnosis
- Evidence of in-service event, injury, or exposure
- Medical nexus connecting current condition to service
- Service treatment records (STRs)
- Private medical records
- Buddy statements and personal statements`,
                    citations: [
                        {
                            file: "VA_Disability_Guide.pdf",
                            page: 15,
                            url: "#",
                            source_text: "To apply for VA disability benefits, you must have a chronic disability that resulted from your military service, was a preexisting condition worsened by your military service, or was caused by an already service-connected disability."
                        },
                        {
                            file: "Benefits_Handbook.pdf",
                            page: 23,
                            url: "#",
                            source_text: "The minimum requirements include a statement of symptoms, evidence of in-service events, and a medical nexus connecting your current condition to your military service."
                        },
                        {
                            file: "Application_Process.pdf",
                            page: 8,
                            url: "#",
                            source_text: "Required documentation includes service treatment records, private medical records, buddy statements, and personal statements describing your condition and its impact."
                        }
                    ]
                },
                'pension': {
                    content: `### **VA Pension Benefits**

VA pension benefits provide monthly payments to wartime veterans with limited income and assets who meet certain age or disability requirements.

#### **Eligibility Criteria**
1. **Service Requirements**:
   - Served 90 days or more of active duty
   - At least one day during wartime period
   - Discharge under other than dishonorable conditions

2. **Income and Asset Limits**:
   - Countable family income below annual limit
   - Net worth below VA limit (currently $138,489)
   - Primary residence and personal effects excluded

3. **Age or Disability**:
   - Age 65 or older, OR
   - Permanently and totally disabled, OR
   - In nursing home for long-term care

#### **Application Process**
- Complete VA Form 21P-527EZ
- Submit income and asset documentation
- Provide medical evidence if claiming disability`,
                    citations: [
                        {
                            file: "Pension_Guide.pdf",
                            page: 12,
                            url: "#",
                            source_text: "VA pension benefits provide monthly payments to wartime veterans with limited income and assets who meet certain age or disability requirements."
                        },
                        {
                            file: "Eligibility_Criteria.pdf",
                            page: 7,
                            url: "#",
                            source_text: "Service requirements include 90 days or more of active duty, at least one day during wartime period, and discharge under other than dishonorable conditions."
                        }
                    ]
                },
                'education': {
                    content: `### **VA Education Benefits**

The VA offers several education benefit programs to help veterans pay for college, graduate school, and training programs.

#### **Post-9/11 GI Bill**
- Covers up to 36 months of education benefits
- Pays tuition and fees directly to school
- Provides monthly housing allowance
- Includes book stipend of up to $1,000 per year

#### **Montgomery GI Bill**
- Active Duty (MGIB-AD) for active duty service
- Selected Reserve (MGIB-SR) for reserve service
- Monthly payments while enrolled in school

#### **Vocational Rehabilitation**
- For service-connected disabilities
- Covers education and training costs
- May include additional services like counseling`,
                    citations: [
                        {
                            file: "GI_Bill_Guide.pdf",
                            page: 5,
                            url: "#",
                            source_text: "The Post-9/11 GI Bill covers up to 36 months of education benefits, pays tuition and fees directly to school, and provides monthly housing allowance."
                        },
                        {
                            file: "Vocational_Rehab.pdf",
                            page: 18,
                            url: "#",
                            source_text: "Vocational Rehabilitation is available for service-connected disabilities and covers education and training costs, with additional services like counseling."
                        }
                    ]
                }
            };
            
            const promptLower = prompt.toLowerCase();
            if (promptLower.includes('disability')) {
                return mockResponses.disability;
            } else if (promptLower.includes('pension') || promptLower.includes('income')) {
                return mockResponses.pension;
            } else if (promptLower.includes('education') || promptLower.includes('gi bill') || promptLower.includes('school')) {
                return mockResponses.education;
            } else {
                return mockResponses.disability;
            }
        }
        
        function displayResponse(data, responseDiv, refsDiv) {
            console.log('Displaying response:', data);
            console.log('Citations:', data.citations);
            
            let formattedContent = data.content;
            
            // Convert markdown headers
            formattedContent = formattedContent
                .replace(/### (.*?)(?=\n|$)/g, '<h3 class="text-2xl font-bold text-green-400 mt-8 mb-4">$1</h3>')
                .replace(/#### (.*?)(?=\n|$)/g, '<h4 class="text-xl font-semibold text-green-300 mt-6 mb-3">$1</h4>');
            
            // Convert numbered lists - Fixed regex
            formattedContent = formattedContent.replace(/(\d+)\.\s+(.*?)(?=\n\d+\.|$)/gs, function(match, number, content) {
                return `<li class="mb-2 text-gray-200">${content}</li>`;
            });
            
            // Wrap numbered lists in ol tags
            formattedContent = formattedContent.replace(/(<li class="mb-2 text-gray-200">.*?<\/li>)+/gs, function(match) {
                return `<ol class="list-decimal list-inside space-y-2 my-4 text-gray-200">${match}</ol>`;
            });
            
            // Convert bullet lists - Fixed regex
            formattedContent = formattedContent.replace(/- (.*?)(?=\n-|$)/gs, function(match, content) {
                return `<li class="mb-2 text-gray-200">${content}</li>`;
            });
            
            // Wrap bullet lists in ul tags
            formattedContent = formattedContent.replace(/(<li class="mb-2 text-gray-200">.*?<\/li>)+/gs, function(match) {
                return `<ul class="list-disc list-inside space-y-2 my-4 text-gray-200">${match}</ul>`;
            });
            
            // Convert bold and italic text
            formattedContent = formattedContent
                .replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold text-green-300">$1</strong>')
                .replace(/\*(.*?)\*/g, '<em class="italic text-gray-300">$1</em>');
            
            // Convert line breaks
            formattedContent = formattedContent
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>');
            
            responseDiv.querySelector('.prose').innerHTML = `
                <h2 class="text-3xl font-bold text-green-400 mb-6 text-center">Answer</h2>
                <div class="text-gray-200 leading-relaxed">
                    ${formattedContent}
                </div>
            `;
            
            // Display citations
            console.log('Checking citations:', data.citations);
            if (data.citations && data.citations.length > 0) {
                console.log('Displaying citations, count:', data.citations.length);
                refsDiv.style.display = 'block';
                refsDiv.querySelector('.space-y-4').innerHTML = '';
                
                data.citations.forEach((c, i) => {
                    const citationDiv = document.createElement('div');
                    citationDiv.className = 'bg-gray-700 rounded-2xl p-6 border border-gray-600';
                    citationDiv.innerHTML = `
                        <div class="flex items-start space-x-4">
                            <div class="w-8 h-8 bg-green-900 rounded-full flex items-center justify-center flex-shrink-0">
                                <span class="text-green-400 font-bold text-sm">${i+1}</span>
                            </div>
                            <div class="flex-1">
                                <a href="${c.url}" target="_blank" class="text-lg font-semibold text-green-400 hover:text-green-300 transition-colors">
                                    ${c.file} (Page ${c.page})
                                </a>
                                ${c.source_text && c.source_text !== 'Source content not available' ? 
                                    `<div class="mt-3 p-4 bg-gray-800 rounded-xl border-l-4 border-green-500">
                                        <p class="text-gray-300 italic">${c.source_text}</p>
                                    </div>` : ''
                                }
                            </div>
                        </div>
                    `;
                    refsDiv.querySelector('.space-y-4').appendChild(citationDiv);
                });
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('prompt').addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    ask();
                }
            });
            
            document.getElementById('prompt').addEventListener('input', function(e) {
                const typingIndicator = document.getElementById('typingIndicator');
                if (e.target.value.length > 0) {
                    typingIndicator.classList.remove('hidden');
                } else {
                    typingIndicator.classList.add('hidden');
                }
            });
            
            document.getElementById('prompt').addEventListener('blur', function() {
                const typingIndicator = document.getElementById('typingIndicator');
                typingIndicator.classList.add('hidden');
            });
        });
        
        // Error handling for message channel issues
        window.addEventListener('error', function(e) {
            if (e.message.includes('message channel closed')) {
                console.warn('Message channel error detected, this is likely harmless for local testing');
            }
        });
    </script>
</body>
</html>
