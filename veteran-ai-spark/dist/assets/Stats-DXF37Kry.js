import{r as m,k as e,T as A,V as _,W as T,Y as U,Z as V,_ as D}from"./vendor-XtmC6Mgf.js";import{C as l,a as o,b as d,c as x,d as N}from"./card-AXAodIwJ.js";import{B as g}from"./badge-CgXGAOiE.js";import{B as k}from"./button-DdCrZ32_.js";import{L as M}from"./vendor-router-Bov98Sdw.js";import{u as H}from"./index-DO0I7TJs.js";import{C as O,G as R,a as W}from"./vendor-maps-CwDBjsXG.js";import{l as q}from"./vendor-charts-B_ZyQ9af.js";import"./vendor-ui-BhCG-mwm.js";const F="https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json",E={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"},K=({className:s})=>{const[n,p]=m.useState(null),[y,w]=m.useState(!0),[h,S]=m.useState(null),[c,v]=m.useState(null);if(m.useEffect(()=>{const t=async()=>{try{const a=await fetch("/api/locations");if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const f=await a.json();console.log("🗺️ Heat map received location data:",f),console.log("🗺️ US states data:",f.us_states),console.log("🗺️ Available state codes:",Object.keys(f.us_states||{})),p(f),S(null)}catch(a){console.error("Error fetching location data:",a),S(a instanceof Error?a.message:"Failed to fetch location data")}finally{w(!1)}};t();const r=setInterval(t,3e4);return()=>clearInterval(r)},[]),y)return e.jsxs(l,{className:s,children:[e.jsx(o,{children:e.jsx(d,{children:"Visitor Locations"})}),e.jsx(x,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Loading map..."})})})]});if(h||!n)return e.jsxs(l,{className:s,children:[e.jsx(o,{children:e.jsx(d,{children:"Visitor Locations"})}),e.jsx(x,{children:e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:h?`Error: ${h}`:"No location data available"})})]});const u=Object.values(n.us_states),b=u.length>0?Math.max(...u):1,C=u.length>0?Math.min(...u.filter(t=>t>0)):0;console.log("🎨 Heat map color scale:",{maxCount:b,minCount:C,stateValues:u});const i=q().domain([0,b]).range(["#e0e7ff","#3b82f6"]),j=t=>{if(!t||!n)return 0;const r=[t.toUpperCase(),t.toLowerCase(),t];for(const a of r)if(n.us_states[a]!==void 0)return n.us_states[a];return 0},L=t=>{const r=j(t);return r===0?"#f8fafc":i(r)};return e.jsxs(l,{className:s,children:[e.jsx(o,{children:e.jsxs(d,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Visitor Locations"}),e.jsxs(g,{variant:"secondary",className:"text-xs",children:[n.total_tracked," tracked"]})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(O,{projection:"geoAlbersUsa",projectionConfig:{scale:1e3},width:800,height:500,className:"w-full h-auto",children:e.jsx(R,{geography:F,children:({geographies:t})=>t.map(r=>{const a=r.properties.STUSPS,f=j(a),I=c===a;return r.rsmKey&&parseInt(r.rsmKey)<5&&console.log(`🗺️ State ${a}:`,{stateCode:a,count:f,color:L(a),availableStates:Object.keys(n.us_states)}),e.jsx(W,{geography:r,fill:L(a),stroke:"#ffffff",strokeWidth:.5,style:{default:{outline:"none"},hover:{fill:I?"#1d4ed8":L(a),outline:"none",strokeWidth:1},pressed:{outline:"none"}},onMouseEnter:()=>v(a),onMouseLeave:()=>v(null)},r.rsmKey)})})}),c&&e.jsxs("div",{className:"absolute top-4 left-4 bg-background border rounded-lg p-3 shadow-lg z-10",children:[e.jsx("div",{className:"font-semibold",children:E[c]||c}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[j(c)," visitors"]})]})]}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-slate-100 border rounded"}),e.jsx("span",{className:"text-muted-foreground",children:"0 visitors"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-200 rounded"}),e.jsx("span",{className:"text-muted-foreground",children:"Low"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded"}),e.jsxs("span",{className:"text-muted-foreground",children:["High (",b,")"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-blue-600",children:Object.keys(n.us_states).length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"States Visited"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-green-600",children:Object.values(n.us_states).reduce((t,r)=>t+r,0)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"US Visitors"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-purple-600",children:n.international}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"International"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-orange-600",children:n.local+n.unknown}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Local/Unknown"})]})]}),Object.keys(n.us_states).length>0&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Top States"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:Object.entries(n.us_states).sort(([,t],[,r])=>r-t).slice(0,6).map(([t,r])=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"font-medium",children:E[t]||t}),e.jsx(g,{variant:"outline",className:"text-xs",children:r})]},t))})]})]})})]})},X=()=>{const[s,n]=m.useState(null),[p,y]=m.useState(!0),[w,h]=m.useState(null),{toast:S}=H(),c=async()=>{try{const i=await fetch("/metrics");if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const j=await i.json();n(j),h(null)}catch(i){console.error("Error fetching stats:",i),h(i instanceof Error?i.message:"Failed to fetch statistics"),S({title:"Error",description:"Failed to fetch statistics. Please try again.",variant:"destructive"})}finally{y(!1)}};m.useEffect(()=>{c();const i=setInterval(c,3e4);return()=>clearInterval(i)},[]);const v=()=>{y(!0),c()},u=i=>{try{return new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(j){return"Unknown"}},b=()=>!s||s.visit_count===0?0:s.ask_count/s.visit_count*100,C=()=>!s||s.unique_visitors===0?0:s.ask_count/s.unique_visitors;return p&&!s?e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"text-lg",children:"Loading statistics..."})]})}):w&&!s?e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-destructive",children:"Error Loading Statistics"}),e.jsx("p",{className:"text-muted-foreground",children:w}),e.jsxs(k,{onClick:v,variant:"outline",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Try Again"]}),e.jsx("div",{className:"mt-4",children:e.jsx(k,{asChild:!0,variant:"ghost",children:e.jsxs(M,{to:"/",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Back to Home"]})})})]})}):e.jsx("div",{className:"min-h-screen bg-background py-12 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("div",{className:"flex items-center justify-center mb-6",children:[e.jsx(k,{asChild:!0,variant:"ghost",className:"mr-4",children:e.jsxs(M,{to:"/",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Back to Home"]})}),e.jsxs(k,{onClick:v,variant:"outline",disabled:p,children:[e.jsx(A,{className:`h-4 w-4 mr-2 ${p?"animate-spin":""}`}),"Refresh"]})]}),e.jsx("h1",{className:"text-5xl md:text-6xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-accent to-primary",children:"Statistics"}),e.jsx("p",{className:"text-xl text-muted-foreground mb-4",children:"Veterans Benefits AI Usage Analytics"}),s&&e.jsxs(g,{variant:"secondary",className:"text-sm",children:["Last updated: ",u(s.last_updated)]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12",children:[e.jsxs(l,{className:"text-center",children:[e.jsxs(o,{className:"pb-3",children:[e.jsxs(d,{className:"flex items-center justify-center space-x-2",children:[e.jsx(T,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{children:"Questions Asked"})]}),e.jsx(N,{children:"Total questions processed by our AI"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-4xl font-bold text-blue-500 mb-2",children:s.ask_count.toLocaleString()})})]}),e.jsxs(l,{className:"text-center",children:[e.jsxs(o,{className:"pb-3",children:[e.jsxs(d,{className:"flex items-center justify-center space-x-2",children:[e.jsx(U,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{children:"Website Visits"})]}),e.jsx(N,{children:"Total page views since launch"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-4xl font-bold text-green-500 mb-2",children:s.visit_count.toLocaleString()})})]}),e.jsxs(l,{className:"text-center",children:[e.jsxs(o,{className:"pb-3",children:[e.jsxs(d,{className:"flex items-center justify-center space-x-2",children:[e.jsx(V,{className:"h-5 w-5 text-purple-500"}),e.jsx("span",{children:"Unique Visitors"})]}),e.jsx(N,{children:"Different users who visited our site"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-4xl font-bold text-purple-500 mb-2",children:s.unique_visitors.toLocaleString()})})]}),e.jsxs(l,{className:"text-center",children:[e.jsxs(o,{className:"pb-3",children:[e.jsxs(d,{className:"flex items-center justify-center space-x-2",children:[e.jsx(D,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{children:"Engagement Rate"})]}),e.jsx(N,{children:"Percentage of visits that asked questions"})]}),e.jsx(x,{children:e.jsxs("div",{className:"text-4xl font-bold text-orange-500 mb-2",children:[b().toFixed(1),"%"]})})]})]}),e.jsx("div",{className:"mb-12",children:e.jsx(K,{})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsx(d,{children:"Service Information"}),e.jsx(N,{children:"Details about our service performance"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Service Started:"}),e.jsx("span",{className:"text-muted-foreground",children:u(s.first_visit)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Questions per Visit:"}),e.jsx("span",{className:"text-muted-foreground",children:(s.ask_count/Math.max(s.visit_count,1)).toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Questions per Unique User:"}),e.jsx("span",{className:"text-muted-foreground",children:C().toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Return Visitor Rate:"}),e.jsxs("span",{className:"text-muted-foreground",children:[s.unique_visitors>0?((1-s.unique_visitors/s.visit_count)*100).toFixed(1):0,"%"]})]})]})]}),e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsx(d,{children:"Real-time Updates"}),e.jsx(N,{children:"Live statistics and system status"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx(g,{variant:"default",className:"bg-green-500",children:"Live"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Auto-refresh:"}),e.jsx(g,{variant:"secondary",children:"Every 30 seconds"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Data Persistence:"}),e.jsx(g,{variant:"outline",children:"Across Restarts"})]}),e.jsx("div",{className:"text-sm text-muted-foreground pt-2",children:"Statistics are updated in real-time and persist across server restarts. All data is stored securely and anonymously."})]})]})]}),e.jsx("div",{className:"text-center mt-12 text-muted-foreground",children:e.jsx("p",{children:"Veterans Benefits AI - Trusted data, free forever"})})]})]})})};export{X as default};
